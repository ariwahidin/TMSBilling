@model TMSBilling.Models.PriceBuy

<form asp-action="Save" method="post">
    <input type="hidden" asp-for="id_seq" />

    <div class="row">
        <div class="col-md-6">
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Vendor ID</label>
                <div class="col-sm-8">
                    <select asp-for="sup_code" asp-items="ViewBag.ListVendor" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Origin</label>
                <div class="col-sm-8">
                    <select asp-for="origin" asp-items="ViewBag.ListOrigin" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Destination</label>
                <div class="col-sm-8">
                    <select asp-for="dest" asp-items="ViewBag.ListDestination" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Service Type</label>
                <div class="col-sm-8">
                    <select asp-for="serv_type" asp-items="ViewBag.ListServiceType" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Service Moda</label>
                <div class="col-sm-8">
                    <select asp-for="serv_moda" asp-items="ViewBag.ListServiceModa" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Truck Size</label>
                <div class="col-sm-8">
                    <select asp-for="truck_size" asp-items="ViewBag.ListTruckSize" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Charge UOM</label>
                <div class="col-sm-8">
                    <select asp-for="charge_uom" asp-items="ViewBag.ListChargeUom" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Currency</label>
                <div class="col-sm-8">
                    <select asp-for="curr" asp-items="ViewBag.ListCurrency" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate</label>
                <div class="col-sm-8">
                    <input asp-for="rate_value" class="form-control currency-input" />
                </div>
            </div>
            
            
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 1</label>
                <div class="col-sm-8">
                    <input asp-for="buy1" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 2</label>
                <div class="col-sm-8">
                    <input asp-for="buy2" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 3</label>
                <div class="col-sm-8">
                    <input asp-for="buy3" class="form-control currency-input" />
                </div>
            </div>
           
           
        </div>

        <div class="col-md-5">
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Flag Min</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="flag_min" id="flag_min" value="1"
                               @(Model.flag_min == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Active</label>
                    </div>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Charge Min</label>
                <div class="col-sm-8">
                    <input asp-for="charge_min" type="number" step="0.01" id="charge_min" class="form-control" max="99999.99" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Flag Range</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flag_range" name="flag_range" value="1"
                               @(Model.flag_range == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Active</label>
                    </div>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Min Range</label>
                <div class="col-sm-8">
                    <input asp-for="min_range" type="number" step="0.01" id="min_range" class="form-control" max="99999.99" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Max Range</label>
                <div class="col-sm-8">
                    <input asp-for="max_range" type="number" step="0.01" id="max_range" class="form-control" max="99999.99" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Empty Pallet</label>
                <div class="col-sm-8">
                    <input asp-for="buy_ret_empt" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Return Cargo</label>
                <div class="col-sm-8">
                    <input asp-for="buy_ret_cargo" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Over Night</label>
                <div class="col-sm-8">
                    <input asp-for="buy_ovnight" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Cancel Cargo</label>
                <div class="col-sm-8">
                    <input asp-for="buy_cancel" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Trip 2</label>
                <div class="col-sm-8">
                    <input asp-for="buytrip2" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Trip 3</label>
                <div class="col-sm-8">
                    <input asp-for="buytrip3" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Diff Area</label>
                <div class="col-sm-8">
                    <input asp-for="buy_diff_area" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Status</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="active_flag" value="1"
                               @(Model.active_flag == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Active</label>
                    </div>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Valid Date</label>
                <div class="col-sm-8">
                    <input asp-for="valid_date" type="date" class="form-control" />
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-11 text-end">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
    </div>
</form>
<script>
    $(document).ready(function () {

        // === ENABLE / DISABLE LOGIC ===
        function toggleChargeMin() {
            $('#charge_min').prop('disabled', !$('#flag_min').is(':checked'));
        }

        function toggleRangeFields() {
            const isChecked = $('#flag_range').is(':checked');
            $('#min_range, #max_range').prop('disabled', !isChecked);
        }

        // Panggil saat halaman load
        toggleChargeMin();
        toggleRangeFields();

        // Event saat checkbox berubah
        $('#flag_min').on('change', toggleChargeMin);
        $('#flag_range').on('change', toggleRangeFields);


        // Fungsi format ribuan
        function formatNumber(value) {
            value = value.replace(/\D/g, ''); // Hapus non-digit
            return value.replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // Tambahkan titik ribuan
        }

        // Saat input diketik
        $('.currency-input').on('input', function () {
            let value = $(this).val().replace(/\D/g, '');
            $(this).val(formatNumber(value));
        });

        // Saat halaman dimuat (form edit)
        $('.currency-input').each(function () {
            let value = $(this).val();
            if (value) {
                // Hapus desimal jika ada
                value = value.split('.')[0]; // Ambil hanya bagian sebelum koma/desimal
                $(this).val(formatNumber(value));
            }
        });

        // Sebelum submit: bersihkan separator
        $('form').on('submit', function () {
            $('.currency-input').each(function () {
                let cleanValue = $(this).val().replace(/\./g, '');
                $(this).val(cleanValue);
            });
        });
    });
</script>
