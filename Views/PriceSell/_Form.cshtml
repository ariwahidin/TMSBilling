@model TMSBilling.Models.PriceSell

@{
    bool isEdit = Model != null && Model.id_seq > 0;
}



<style>

    .form-price-sell * {
        font-size: 12px;
    }

</style>

<form method="post" asp-action="Save">
    <input type="hidden" asp-for="id_seq" />

    <div class="row form-price-sell">
        <!-- LEFT COLUMN -->
        <div class="col-md-6">
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Customer Main</label>
                <div class="col-sm-8">
                    @* <select asp-for="cust_code" asp-items="ViewBag.ListCustomer" class="form-select select2" required>
                        <option value="">Select an Option</option>
                    </select> *@
                    <select asp-for="cust_code" asp-items="ViewBag.ListCustomer"
                            class="form-select select2"
                            required
                            disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Origin</label>
                <div class="col-sm-8">
                    <select asp-for="origin" asp-items="ViewBag.ListOrigin" class="form-select select2" disabled="@isEdit" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Destination</label>
                <div class="col-sm-8">
                    <select asp-for="dest" asp-items="ViewBag.ListDestination" class="form-select select2" disabled="@isEdit" required>
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Service Type</label>
                <div class="col-sm-8">
                    <select asp-for="serv_type" asp-items="ViewBag.ListServiceType" class="form-select select2" disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Service Moda</label>
                <div class="col-sm-8">
                    <select asp-for="serv_moda" asp-items="ViewBag.ListServiceModa" class="form-select select2" disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Truck Size</label>
                <div class="col-sm-8">
                    <select asp-for="truck_size" asp-items="ViewBag.ListTruckSize" class="form-select select2" disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Charge UOM</label>
                <div class="col-sm-8">
                    <select asp-for="charge_uom" asp-items="ViewBag.ListChargeUom" class="form-select select2" disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Currency</label>
                <div class="col-sm-8">
                    <select asp-for="curr" asp-items="ViewBag.ListCurrency" class="form-select select2" disabled="@isEdit">
                        <option value="">Select an Option</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Currency</label>
                <div class="col-sm-8">
                    <input asp-for="rate_value" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 1</label>
                <div class="col-sm-8">
                    <input asp-for="sell1" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 2</label>
                <div class="col-sm-8">
                    <input asp-for="sell2" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate 3</label>
                <div class="col-sm-8">
                    <input asp-for="sell3" class="form-control currency-input" />
                </div>
            </div>


            
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-md-5">

            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Flag Min</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flag_min" name="flag_min" value="1"
                               @(Model.flag_min == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Yes</label>
                    </div>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Charge Min</label>
                <div class="col-sm-7">
                    <input asp-for="charge_min" id="charge_min" class="form-control" type="number" step="0.01" max="99999.99" />
                </div>
            </div>

            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Flag Range</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flag_range" name="flag_range" value="1"
                               @(Model.flag_range == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Yes</label>
                    </div>
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Min Range</label>
                <div class="col-sm-7">
                    <input asp-for="min_range" id="min_range" class="form-control" type="number" step="0.01" max="99999.99" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Max Range</label>
                <div class="col-sm-7">
                    <input asp-for="max_range" id="max_range" class="form-control" type="number" step="0.01" max="99999.99" />
                </div>
            </div>

            <!-- Tambahan Sell Rate -->
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Return Empty</label>
                <div class="col-sm-8">
                    <input asp-for="sell_ret_empty" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Return Cargo</label>
                <div class="col-sm-8">
                    <input asp-for="sell_ret_cargo" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Over Night</label>
                <div class="col-sm-8">
                    <input asp-for="sell_ovnight" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Cancel</label>
                <div class="col-sm-8">
                    <input asp-for="sell_cancel" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Trip 2</label>
                <div class="col-sm-8">
                    <input asp-for="selltrip2" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Trip 3</label>
                <div class="col-sm-8">
                    <input asp-for="selltrip3" class="form-control currency-input" />
                </div>
            </div>
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Rate Diff Area</label>
                <div class="col-sm-8">
                    <input asp-for="sell_diff_area" class="form-control currency-input" />
                </div>
            </div>

            
            

            <!-- Flags -->
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Active</label>
                <div class="col-sm-8 d-flex align-items-center">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="active_flag" value="1"
                               @(Model.active_flag == 1 ? "checked" : "") />
                        <label class="form-check-label ms-2">Yes</label>
                    </div>
                </div>
            </div>
            <!-- Valid Date -->
            <div class="mb-3 row">
                <label class="col-sm-4 col-form-label text-end">Valid Date</label>
                <div class="col-sm-7">
                    <input asp-for="valid_date" type="date" class="form-control" />
                </div>
            </div>
        </div>
    </div>

    <!-- BUTTON -->
    <div class="row mt-3">
        <div class="col-md-12 text-end">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
    </div>
</form>


<script>
    $(document).ready(function () {

        // === ENABLE / DISABLE LOGIC ===
        function toggleChargeMin() {
            $('#charge_min').prop('disabled', !$('#flag_min').is(':checked'));
        }

        function toggleRangeFields() {
            const isChecked = $('#flag_range').is(':checked');
            $('#min_range, #max_range').prop('disabled', !isChecked);
        }

        // Panggil saat halaman load
        toggleChargeMin();
        toggleRangeFields();

        // Event saat checkbox berubah
        $('#flag_min').on('change', toggleChargeMin);
        $('#flag_range').on('change', toggleRangeFields);


        // Fungsi format ribuan
        function formatNumber(value) {
            value = value.replace(/\D/g, ''); // Hapus non-digit
            return value.replace(/\B(?=(\d{3})+(?!\d))/g, '.'); // Tambahkan titik ribuan
        }

        // Saat input diketik
        $('.currency-input').on('input', function () {
            let value = $(this).val().replace(/\D/g, '');
            $(this).val(formatNumber(value));
        });

        // Saat halaman dimuat (form edit)
        $('.currency-input').each(function () {
            let value = $(this).val();
            if (value) {
                // Hapus desimal jika ada
                value = value.split('.')[0]; // Ambil hanya bagian sebelum koma/desimal
                $(this).val(formatNumber(value));
            }
        });

        // Sebelum submit: bersihkan separator
        $('form').on('submit', function () {
            $('select:disabled').prop('disabled', false);
            $('.currency-input').each(function () {
                let cleanValue = $(this).val().replace(/\./g, '');
                $(this).val(cleanValue);
            });
        });
    });
</script>
